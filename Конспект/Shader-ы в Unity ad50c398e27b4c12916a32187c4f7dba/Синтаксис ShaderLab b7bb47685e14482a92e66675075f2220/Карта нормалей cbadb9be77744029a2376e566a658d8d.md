# Карта нормалей

Заставим наш шейдер работать с картами нормали

```c
Shader "ShaderLessions/NormalMapShader"
{
    Properties
    {
        _MainTex ("Main texture", 2D) = "white" {}
        _BumpMap ("Normal map", 2D) = "bump" {}
    }

    SubShader
    {
        CGPROGRAM
        #pragma surface surf Lambert

        sampler2D
            _MainTex,
            _BumpMap;

        struct Input
        {
            half2 uv_MainTex;
        };

        void surf(Input IN, inout SurfaceOutput o)
        {
            o.Albedo = tex2D(_MainTex, IN.uv_MainTex);
            o.Normal = UnpackNormal(tex2D(_BumpMap, IN.uv_MainTex));
        }
        ENDCG
    }
}
```

![Untitled](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D0%B5%D0%B8%CC%86%20cbadb9be77744029a2376e566a658d8d/Untitled.png)

Тип освещения `Lambert`

![Untitled](%D0%9A%D0%B0%D1%80%D1%82%D0%B0%20%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D0%B5%D0%B8%CC%86%20cbadb9be77744029a2376e566a658d8d/Untitled%201.png)

Тип освещения `BlinnPhong`

Мы в процессе написания шейдера воспользовались такой функцией, как `UnpackNormal`. Эта функция автоматический распаковывает текстуру с нормалями для модели, делая это правильно. Если попробовать передать на `Normal` просто цвет пикселя текстуры, то получится довольно странная картина. Помимо этого стоит обратить внимание на то, что в значениях по умолчанию у карты нормали указано значение `"bump"` — это карта, в которой компонент oZ(то есть Blue) всегда стоит в 1. Да и в unity есть соглашение, называть карту нормалей Bump(От английского выпуклсоть).

### Что то как-то не ощущается разницы, да не видно никаких выпуклостей

Да, кажется что изменений и не произошло. Но это лишь связано с тем, какой источник света мы используем и что за карту нормалей мы использовали. Если выпуклости на карте были большими, то мы бы их увидели. Однако из-за того, что свет у шейдера типа `Lambert`, то никаких бликов или отражений мы не видим. Чтобы это исправить, нужно поменять тип освещения на `BlinnPhong`. Однако нельзя просто так поменять в настройках шейдера строчку 

```c
#pragma surface surf Lambert
```

на 

```c
#pragma surface surf BlinnPhong
```

Некоторые типы освещения требуют дополнительных параметров для их корректной работы. Так, `BlinnPhong` требует два параметра: 

1. Насколько блик резкий (`Specular`)
2. Его сила блеска (`Gloss`)

Потому чтобы все заработало, нужно вставить следующий код:

```c
Shader "ShaderLessions/NormalMapShader"
{
    Properties
    {
        _MainTex ("Main texture", 2D) = "white" {}
        _BumpMap ("Normal map", 2D) = "bump" {}
        
        _Shiness ("Shiness", Range(0,1)) = 0.07 // резкость/яркость отражения
        _SpecColor ("Specular Color", Color) = (0.5, 0.5, 0.5, 1.0) // Этот параметр должен иметь строго название _SpecColor
		    _Specularity = ("Specularity", Range(0,1)) = (1,1,1,1)// уровень отображения/зеркальности
		}

    SubShader
    {
        CGPROGRAM
        #pragma surface surf BlinnPhong

        sampler2D
            _MainTex,
            _BumpMap;

        half _Shiness;
        
        struct Input
        {
            half2 uv_MainTex;
        };

        void surf(Input IN, inout SurfaceOutput o)
        {
            o.Albedo = tex2D(_MainTex, IN.uv_MainTex);
            o.Normal = UnpackNormal(tex2D(_BumpMap, IN.uv_MainTex));
            o.Specular = _Shiness; // резкость/яркость отражения
            o.Gloss = _Specularity; // блеск
        }
        ENDCG
    }
}
```

О типах освещениях можно посмотреть в разделе 

[Типы освещений в Unity](%D0%A2%D0%B8%D0%BF%D1%8B%20%D0%BE%D1%81%D0%B2%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B8%CC%86%20%D0%B2%20Unity%207afee640b5a3488d865fb26c6fb550e0.md)